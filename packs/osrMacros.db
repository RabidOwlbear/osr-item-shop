{"_id":"N03nXFI0ulHN01nr","name":"Ye Fast Pack","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/commodities/currency/coins-patched-pouch-white.webp","scope":"global","command":"async function main(){\n    const numSelected = canvas.tokens.controlled;\n    console.log(numSelected)\n    if(numSelected > 1 || numSelected == 0){\n        ui.notifications.warn('Please select one token')\n        return;\n    }\n    const actor = canvas.tokens.controlled[0].actor;\n    console.log(actor)\n    new OSRIS.fp.fastPack(actor).render(true);\n}\nmain()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.F6pcIIXCCq7spz5L"}}}
{"name":"Attack Macro","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/weapons/swords/swords-cutlasses-white.webp","scope":"global","command":"main()\n\nasync function main(){\n  // Get Selected\n  let selected = canvas.tokens.controlled;\n  console.log(selected.length)\n if(selected.length > 1 || selected.length < 1){\n   ui.notifications.error(\"Please select  one token\")\n    return;\n  }\n  let selectedActor = selected[0].actor;\n  console.log(selectedActor)\n  // Get Target\n  let targets = Array.from(game.user.targets)\n  if(targets.length == 0 || targets.length > 1 ){\n    ui.notifications.error(\"Please target one token\");\n    return;\n  }\n  let targetActor = targets[0].actor;\n  // Select Weapon\n  // Why Filter instead of Find?\n  let actorWeapons = selectedActor.data.items.filter(item => item.type == \"weapon\");\n  let actorSpells = selectedActor.data.items.filter(item => {\n      //console.log('spell', item.data.data.roll)\n     if( item.type == \"spell\" ) return true;\n      \n  });\n  console.log('spells', actorSpells,'weapons', actorWeapons)\n  let atkOptions = \"\"\n  for(let item of actorWeapons){\n    atkOptions += `<option value=${item._id}>${item.name} | ATK: ${item.data.data.damage}</option>`\n  }\n  for(let item of actorSpells){\n      //console.log('it',item)\n      if(item.data.data.roll != \"\"){\n    atkOptions += `<option value=${item._id}>${item.name} | ATK: ${item.data.data.roll}</option>`}\n  }\n    console.log('atk',atkOptions)\n  let dialogTemplate = `\n  <h1> Pick a weapon </h1>\n  <div style=\"display:flex\">\n    <div  style=\"flex:1\"><select id=\"weapon\">${atkOptions}</select></div>\n    <span style=\"flex:1\">Mod <input  id=\"mod\" type=\"number\" style=\"width:50px;float:right\" value=0 /></span>\n    <span style=\"flex:1\"><input id=\"ranged\" type=\"checkbox\" unchecked />Ranged</span>\n    </div>\n  `\n  new Dialog({\n    title: \"Roll Attack\", \n    content: dialogTemplate,\n    buttons: {\n      rollAtk: {\n        label: \"Roll Attack\", \n        callback: async (html) => {\n            console.log(html)\n          let wepID = html.find(\"#weapon\")[0].value;\n          let wep = selectedActor.data.items.find(item => item._id == wepID)\n          console.log('wep',wep)\n          let wepMod = wep.data.data.bonus;\n          let modifier = html.find(\"#mod\")[0].value;\n          let ranged = html.find(\"#ranged\")[0].checked;\n          let str = selectedActor.data.data.scores?.str ? selectedActor.data.data.scores.str.mod : 0;\n          let dex = selectedActor.data.data.scores?.dex ? selectedActor.data.data.scores.dex.mod : 0;\n          let abMod = dex?.mod && !ranged ? str.mod : dex;\n          \n          if (ranged != true){\n              abMod =  str;\n          }else{\n              abMod = dex;\n          }\n          // Roll Attack\n          let actThac0 = 19 - selectedActor.data.data.thac0.value;\n          let newRollString = `1d20 + ${actThac0} + ${abMod} + ${wepMod} + ${modifier}`\n          console.log(newRollString)\n          let roll = new Roll(newRollString).roll();\n          console.log('roll',roll)\n          await game.dice3d.showForRoll(roll)\n          // See if Attack is Greater than their armor, if so\n          let result = roll.total\n          // Print Chat with Button to Roll Damage\n          let chatTemplate = \"\"\n          let armor = targetActor.data.data.aac.value;\n          if(result >= armor){\n            //new Roll().roll(result);\n            chatTemplate = `\n            <p> Rolled: ${result}</p>\n            <p> It was a Hit! </p>\n            <p> <button id=\"rollDamage\">Roll Damage</button></p>\n            `\n          \n          } else {\n            chatTemplate = `\n            <p> Rolled: ${result} </p>\n            <p> It was a Miss! </p>\n            `          }\n          ChatMessage.create({\n            speaker: {\n              alias: selectedActor.name\n            },\n            content: chatTemplate,\n            roll: roll\n                })\n          \n          // Roll Damage\n          Hooks.once('renderChatMessage', (chatItem, html) => {\n            html.find(\"#rollDamage\").click(() => {\n              let dmgMod = 0;\n              if (ranged != true){dmgMod = str}\n              //console.log(\"Damage Button Clicked\")\n              let wepMod = wep.data?.data.bonus ? wep.data.data.bonus : 0;\n              let wepDmg = wep.data?.data.damage ? wep.data.data.damage : \"\"\n              let wepDmgFin = `${wepDmg} + ${wepMod} + ${dmgMod}`\n              console.log('dmg',wepDmgFin)\n              new Roll(wepDmgFin).roll().toMessage();\n            })\n          })         \n        }\n      }, \n      close: {\n        label: \"Close\"\n      }\n    }\n  }).render(true)\n}","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.EHhPh5tj1xQizoIY"}},"_id":"RmtY8NZVEZPugiD5"}
{"_id":"U1je3KUD6gL5xqji","name":"OSR Item Shop","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/environment/settlement/market-stall.webp","scope":"global","command":"OSRIS.shop.renderItemShop()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.VwRe4Z44Bq8DXTc6"}}}
{"name":"Buy Random Items","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/skills/trades/gaming-gambling-dice-gray.webp","scope":"global","command":"async function main(){\n   \n   if(canvas.tokens.controlled.length == 0 || canvas.tokens.controlled.length > 1 ){\n       console.log('woot')\n       ui.notifications.warn('Please select one token')\n       return;\n   }\n   const actor = canvas.tokens.controlled[0].actor;\n   buyRandomItems(actor, 'items');\n   \n}\nmain()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.9Z1bOAVrwGKNFS8h"}},"_id":"adD80X20DtqHi5Zf"}
{"_id":"N03nXFI0ulHN01nr","name":"Ye Fast Pack","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/commodities/currency/coins-patched-pouch-white.webp","scope":"global","command":"async function main(){\n    OSRIS.fp.renderFastPack()\n}\nmain()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.F6pcIIXCCq7spz5L"}}}
{"_id":"adD80X20DtqHi5Zf","name":"Buy Random Items","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/skills/trades/gaming-gambling-dice-gray.webp","scope":"global","command":"async function main(){\n   \n   if(canvas.tokens.controlled.length == 0 || canvas.tokens.controlled.length > 1 ){\n       console.log('woot')\n       ui.notifications.warn('Please select one token')\n       return;\n   }\n   const actor = canvas.tokens.controlled[0].actor;\n   buyRandomItems(actor, 'equipment');\n   \n}\nmain()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.9Z1bOAVrwGKNFS8h"}}}
{"_id":"adD80X20DtqHi5Zf","name":"Buy Random Items","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/skills/trades/gaming-gambling-dice-gray.webp","scope":"global","command":"async function main(){\n   \n   if(canvas.tokens.controlled.length == 0 || canvas.tokens.controlled.length > 1 ){\n       console.log('woot')\n       ui.notifications.warn('Please select one token')\n       return;\n   }\n   const actor = canvas.tokens.controlled[0].actor;\n   OSRIS.util.buyRandomItems(actor, 'equipment');\n   \n}\nmain()","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.9Z1bOAVrwGKNFS8h"}}}
{"_id":"adD80X20DtqHi5Zf","name":"Buy Random Items","type":"script","author":"8rmH3EKPBBOSJGfb","img":"icons/skills/trades/gaming-gambling-dice-gray.webp","scope":"global","command":"OSRIS.util.buyRandomItems();","folder":null,"sort":0,"permission":{"default":0,"8rmH3EKPBBOSJGfb":3},"flags":{"core":{"sourceId":"Macro.9Z1bOAVrwGKNFS8h"}}}
{"$$deleted":true,"_id":"RmtY8NZVEZPugiD5"}
